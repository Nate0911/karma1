<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reddit Karma Checker</title>
  <style>
    body { font-family: sans-serif; padding:2rem; background:#f9f9f9 }
    button { padding:0.5rem 1rem; font-size:1rem; }
    #karma { margin-top:1rem; font-size:1.25rem; }
  </style>
</head>
<body>
  <h1>üîê Login with Reddit</h1>
  <button id="login">Log in</button>
  <div id="karma" style="display:none">
    Your total karma: <strong id="count"></strong>
  </div>

  <script>
    // ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const clientId   = 'svkx52WYcdXXTuAdjnI1ng';
    const redirectTo = window.location.origin + window.location.pathname; 
    const stateToken = Math.random().toString(36).substring(2);
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    document.getElementById('login').onclick = () => {
      const url = new URL('https://www.reddit.com/api/v1/authorize.compact');
      url.searchParams.set('client_id',    clientId);
      url.searchParams.set('response_type','token');          // implicit flow
      url.searchParams.set('state',        stateToken);
      url.searchParams.set('redirect_uri', redirectTo);
      url.searchParams.set('duration',     'temporary');
      url.searchParams.set('scope',        'identity read');
      window.location = url;
    };

    window.addEventListener('load', () => {
      // if we were just redirected back with a token...
      if (window.location.hash) {
        const hash = new URLSearchParams(window.location.hash.slice(1));
        if (hash.get('state') !== stateToken) {
          return alert('State mismatch ‚Äì possible CSRF.');
        }
        const token = hash.get('access_token');
        if (token) fetchKarma(token);
      }
    });

    function fetchKarma(token) {
      fetch('https://oauth.reddit.com/api/v1/me', {
        headers: {
          'Authorization': 'bearer ' + token,
          'User-Agent': 'karmaApp/1.0 by u/YourRedditUsername'
        }
      })
      .then(r => r.json())
      .then(d => {
        document.getElementById('count').textContent = d.total_karma;
        document.getElementById('karma').style.display = 'block';
      })
      .catch(console.error);
    }
  </script>
</body>
</html>
